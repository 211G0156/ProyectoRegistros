<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
@*     <title>Talleres</title>
 *@    <link rel="stylesheet" href="~/css/Visitante.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />


</head>
<body>

    <div class="historial">
        <h2>Historial de registro</h2>

        <div class="datosHistorial">
            @* <label><b>03/09/2025       02:08 P.M.</b></label> *@
            @* <hr /> *@
            @* <p> <b>Pepito J.</b> añadió al alumno/a <b>Juanito S.</b> a los talleres de: <b>AcuarelaKids</b></p> *@
        </div>
    </div>


    <aside id="menu-abierto">
        <img src="~/img/logo.png">
        <h3>@User.FindFirst("Rol")?.Value</h3>
        <h3>@User.FindFirst("PrimerNombre")?.Value</h3>
        <div>
            <span class="material-symbols-outlined">edit_square</span>
            <a href="/Visitante/Visitante/Index">Talleres</a>
        </div>
        <div>
            <span class="material-symbols-outlined">library_books</span>
            <a href="/Visitante/Visitante/RegistroForm">Registros</a>
        </div>
        <div>
            <span class="material-symbols-outlined">logout</span>
            <a href="~/Home/Index">Cerrar sesión</a>
        </div>
    </aside>

<main>

    @RenderBody()

</main>

    <script src="~/js/Visitante.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder().withUrl("/historialHub").build();

            connection.on("RecibirHistorial", (data) => {
            const contenedor = document.querySelector(".historial .datosHistorial");
            const nuevo = `
                <div class="registro-item">
                    <label><b>${data.fecha}</b></label>
                    <hr />
                    <p><b>${data.profe}</b> añadió al alumno/a <b>${data.alumno}</b>
                    a los talleres de: <b>${data.taller}</b></p>
                </div>
            `;
            contenedor.insertAdjacentHTML("afterbegin", nuevo);
        });

        connection.start().catch(err => console.error(err.toString()));
    </script>
    <script>
        setInterval(() => {
            fetch("/Home/VerificarSesionRol")
                .then(r => r.json())
                .then(data => {
                    if (!data.valido) {
                        alert("Tu rol ha sido modificados. Debes iniciar sesión nuevamente.");
                        window.location.href = "/Home/Index";
                    }
                });
        }, 5000);
    </script>

</body>
</html>