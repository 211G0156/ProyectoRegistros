@using ProyectoRegistros.Models
@model ProyectoRegistros.Areas.Profe.Models.ViewModels.MisTalleresViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = "LayoutProfe";
}



<form id="datos-alumno" method="get" asp-action="RegistroForm">
    <h3>Datos del alumno</h3><br>
    <section>
        <label>Nombre:</label><br>
        <input asp-for="Alumno.Nombre" type="text" placeholder="Escribir..."><br>
        <label>Fecha de cumpleaños:</label><br>
        <input asp-for="Alumno.FechaCumple" type="date"><br>
        <label>Dirección:</label><br>
        <input asp-for="Alumno.Direccion" type="text" placeholder="Escribir..."><br>
    </section>
    <section>
        <label>Edad:</label><br>
        <input asp-for="Alumno.Edad" type="number" placeholder="Escribir..."><br>
        <label>Número de contacto:</label><br>
        <input asp-for="Alumno.NumContacto" type="text" placeholder="Escribir..."><br>
    </section>

    <section id="datAlum-padeci">
        <span><label>Padecimientos</label><input type="checkbox" /></span><br>
        <textarea asp-for="Alumno.Padecimientos" placeholder="Escribir..." disabled></textarea><br>
    </section>


    <section>
        <label>Tutor:</label><br>
        <input asp-for="Alumno.Tutor" type="text" placeholder="Escribir..."><br>
        <label>Email:</label><br>
        <input asp-for="Alumno.Email" type="email" placeholder="Escribir..."><br>
    </section>
    <section>
        <label>Teléfono:</label><br>
        <input asp-for="Alumno.NumSecundario" type="text" placeholder="Escribir..."><br>
    </section><br>


    <hr size="2" width="100%" style="grid-column: span 2;">

    <!--listaaaaaaaaaa-->
    <h3>Oferta de talleres</h3><br>
    <div id="contenedor-talleres">
        @foreach (var taller in Model.Talleres)
        {
            if (taller.LugaresDisp >= 1)
            {
                <div class="op-taller">
                    <input class="check" type="checkbox">
                    <label class="nombreTaller">@taller.Nombre</label>
                    <label class="label-dias">@taller.Dias</label>
                    <label class="label-horas">@taller.HoraInicio - @taller.HoraFinal</label>
                    <label>@taller.LugaresDisp</label>
                </div>

                <br>
            }
        }


    </div><br>
    <div id="contenedor-abajo">

        <div class="tamaño">
            <label>Lista de espera</label>
            <select>
                @foreach (var t in Model.Talleres)
                {
                    if (t.LugaresDisp < 1)
                    {
                        <option>@t.Nombre<span>  @t.Dias</span> <span>  @t.HoraInicio - @t.HoraFinal</span></option>
                    }
                }
            </select>
        </div><br>
    </div><br>

    <div style="display: inline-flex; justify-content: space-between; width: 100%; grid-column: span 2;">
        <button type="button" class="buttons">Limpiar</button>
        <button id="finalizar" type="button" class="buttons">Finalizar</button>
    </div>
</form>


<div class="modal" id="modal-recibo">
    <form>
        <h2>Confirmación de datos</h2>
        <section id="donativo">
            <label>Pagado</label>
            <input type="checkbox">
            <label>$300</label>
        </section>

        <hr size="2" width="99%" style="margin-top: -25px;"><br>
        <section>
            <label>Nombre: </label><br>
            <label>Cumpleaños: </label><br>
            <label>Dirección: </label><br>
            <label>Número de contacto: </label><br>
            <label>Padecimientos: </label><br>
            <label>Tutor: </label><br>
            <label>Email: </label><br>
            <label>Telefono: </label><br>
            <label>Talleres registrados: </label><br>
        </section>
        <section>
            <label>Myriam Ramirez Carreño</label><br>
            <label>31/07/03</label><br>
            <label>Madero</label><br>
            <label>862125555</label><br>
            <label>No</label><br>
            <label>Selena Garcia</label><br>
            <label>Selena@gmail.com</label><br>
            <label>862125555</label><br>
            <label> AcuarelaKids, Teatro, Fotografía.</label><br>
        </section>

        <div style="display: inline-flex; justify-content: space-between; width: 100%;">
            <button type="button" class="buttons">Cancelar</button>
            <button type="submit" class="buttons">Aceptar</button>
        </div>
    </form>
</div>

<script>
const buscarTexto = "atencion psicopedagogica";
const limpiar = t => t.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim(); // para problemas con acentos

document.querySelectorAll(".op-taller").forEach(op => {
  op.addEventListener("click", e => {
    e.stopPropagation();
    const checkbox = op.querySelector("input[type='checkbox']");
    const nombre = limpiar(op.querySelector(".nombreTaller").textContent);
    const esAtencion = nombre.includes(limpiar(buscarTexto));

    if (esAtencion && checkbox.checked) {
      checkbox.checked = false; 
      cerrarInputs();     
      return;                 
    }
    cerrarInputs();

    if (!esAtencion) {
      checkbox.checked = !checkbox.checked;
      return;
    }

    checkbox.checked = true;

    ["dias", "horas"].forEach(tipo => {
      const label = op.querySelector(`.label-${tipo}`);
      let input = document.createElement("input");
      input.type = "text";
      input.className = `input-${tipo}`;
      input.value = label.textContent.trim() || `Sin ${tipo}`;
      label.style.display = "none";
      label.after(input);
      input.focus();
      input.addEventListener("click", ev => ev.stopPropagation());
    });
  });
});

document.addEventListener("click", cerrarInputs);

function cerrarInputs() {
  document.querySelectorAll(".op-taller").forEach(op => {
    ["dias", "horas"].forEach(tipo => {
      const input = op.querySelector(`.input-${tipo}`);
      const label = op.querySelector(`.label-${tipo}`);
      if (input) {
        label.textContent = input.value.trim() || `Sin ${tipo}`;
        input.remove();
        label.style.display = "inline-block";
      }
    });
  });
}

</script>