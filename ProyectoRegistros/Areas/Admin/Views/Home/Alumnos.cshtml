@model IEnumerable<ProyectoRegistros.Areas.Admin.Models.ViewModels.AlumnosViewModel>

@{
    Layout = "LayoutAdmin";
    var tallerIdSeleccionado = ViewData["CurrentTallerId"] as int?;
}

<!--MODAL PARA EDITAR-->

<div class="modal" id="modal-EditTaller">
    <form>
        <button class="cerrar" type="button">X</button><br>
        <div id="acomodar">
            <i class="material-symbols-outlined">person</i>
            <h2>Editar alumno</h2>
        </div><br>

        <label>Nombre:</label><br>
        <input class="inputForms" type="text" placeholder="Mariana...."><br>
        <label>Tutor:</label><br>
        <input class="inputForms" type="text" placeholder="Escribir..."><br>
        <label>Teléfono:</label><br>
        <input class="inputForms" type="text" placeholder="Escribir..."><br>
        <label>Teléfono 2:</label><br>
        <input class="inputForms" type="text" placeholder="Escribir..."><br>

        <label>Padecimientos:</label><br>
        <input class="inputForms" type="text" placeholder="Escribir..."><br>
        <label>Talleres:</label><br>
        <div class="custom-select">
            <div class="select-header">
                <span>Selecciona opciones</span>
                <i class="fa fa-caret-down"></i>
            </div>
            <div class="select-content">
                <label><input type="checkbox" /> Opción 1</label>
                <label><input type="checkbox" /> Opción 2</label>
                <label><input type="checkbox" /> Opción 3</label>
            </div>
        </div>
        <div class="error" style=" margin-top: 5px; margin-bottom:5px; ">
            <p>El nombre ya existe!</p>
            <p>El nombre del taller ya existe!</p>
        </div>
        <div style="display: flex; justify-content: center;">
            <button style="display: flex; justify-content: center;" type="submit" class="buttons">Guardar</button>
        </div>
    </form>
</div>

<!--MODAL PARA ELIMINAR-->
<div class="modal" id="modal-DeleteTaller">
    <form style="margin-top:140px;">
        <button class="cerrar" type="button">X</button><br>
        <fieldset style="border:none;">
            <legend>
                <h2>¿Desea eliminar al alumno en alguno de estos talleres?</h2>
                <div class="scroll-eliminar">
                    <table>
                        <thead>
                            <tr>
                                <th>Taller</th>
                                <th>Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>AcuarelaKids</td>
                                <td><button class="eliminar-taller">x</button></td>
                            </tr>
                            <tr>
                                <td>Pintura</td>
                                <td><button class="eliminar-taller">x</button></td>
                            </tr>
                            <tr>
                                <td>Violin</td>
                                <td><button class="eliminar-taller">x</button></td>
                            </tr>
                            <tr>
                                <td>Violin</td>
                                <td><button class="eliminar-taller">x</button></td>
                            </tr>

                            <tr>
                                <td>Violin</td>
                                <td><button class="eliminar-taller">x</button></td>
                            </tr>

                            <tr>
                                <td>Violin</td>
                                <td><button class="eliminar-taller">x</button></td>
                            </tr>

                            <tr>
                                <td>Violin</td>
                                <td><button class="eliminar-taller">x</button></td>
                            </tr>

                        </tbody>
                    </table>

                </div>
            </legend>
        </fieldset>
        <div style="margin: 0vh 0 0 1vw; justify-content: flex-end; display: flex;">
            <button type="submit" class="buttons">Confirmar</button>
        </div>
    </form>
</div>


<header class="principal">
    <div class="izq">
        <img id="ig1" class="reg" src="~/img/arrow_back.png" />
        <h2>Alumnos</h2>
    </div>
    <img id="ig2" src="~/img/Historial.png" />
</header>

<div class="filtros">
    <div class="buscador3">
        <input type="search" id="fil" name="searchTerm"
               placeholder="Buscar" value="@ViewData["CurrentFilter"]" />
    </div>

    <select id="filtro-taller"
            style="height: 37px; box-shadow:0px 0px 0px 0px rgba(128, 128, 128, 0.555) !important; width: 250px; border-radius: 20px; border: 1px solid black; padding-left: 10px; font-size: 17px; background-color: white; margin-left: 15px;">
        <option value="0">Todos los talleres</option>
        @if (ViewBag.Talleres != null)
        {
            foreach (var taller in ViewBag.Talleres)
            {
                <option value="@taller.Id" selected="@(taller.Id == tallerIdSeleccionado)">@taller.Nombre</option>
            }
        }
    </select>
</div>

<div id="tabla-container">
    @await Html.PartialAsync("_AlumnosTabla", Model)
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {

        const searchInput = document.getElementById('fil');
        const tallerSelect = document.getElementById('filtro-taller');
        const tablaContainer = document.getElementById('tabla-container');
        let debounceTimer;

        function actualizarTabla() {
            const searchTerm = searchInput.value;
            const tallerId = tallerSelect.value;

            const url = `@Url.Action("Alumnos", "Home")?searchTerm=${encodeURIComponent(searchTerm)}&tallerId=${tallerId}`;

            fetch(url, {
                method: 'GET',
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.text())
            .then(html => {
                tablaContainer.innerHTML = html;
            })
            .catch(error => console.error('Error al actualizar la tabla:', error));
        }

        searchInput.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(actualizarTabla, 300);
        });

        tallerSelect.addEventListener('change', actualizarTabla);


        searchInput.addEventListener('input', function(e) {
            const regex = /[^a-zA-Z\s\u00C0-\u017F]/g;
            this.value = this.value.replace(regex, '');
        });
    });
</script>