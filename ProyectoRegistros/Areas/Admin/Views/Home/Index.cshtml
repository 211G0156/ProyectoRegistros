@model IEnumerable<ProyectoRegistros.Areas.Admin.Models.ViewModels.TalleresViewModel>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    Layout = "LayoutAdmin";
}

<!--MODAL PARA AGREGAR-->

<div class="modal" id="modal-AddTaller">
    <form asp-area="Admin" asp-controller="Home" asp-action="AgregarTaller" method="post">
        <button class="cerrar" type="button">X</button><br>
        <div id="acomodar">
            <i class="material-symbols-outlined">person</i>
            <h2>Agregar Taller</h2>
        </div><br>

        <label>Nombre:</label><br>
        <input class="inputForms" name="Nombre" type="text" placeholder="Escribir..."><br>
        <label>Dias:</label><br>
        <input class="inputForms" name="Dias" type="text" placeholder="Escribir..."><br>

        <label>Espacios:</label><br>
        <input class="inputForms" name="Lugares_Disp" type="number" min="0" placeholder="Escribir..."><br>

        <div class="col">
            <label>Horario inicio:</label><br>
            <input class="inputForms" name="Hora_inicio" type="time" style="width:25%;"><br>
            <label>Horario final:</label><br>
            <input class="inputForms" name="Hora_final" type="time" style="width:25%;"><br>


        </div>
        <div class="col">
            <label>Edad minima:</label><br>
            <input class="inputForms" name="Edad_min" style="width:15%;" min="0" type="number" placeholder="..."><br>
            <label>Edad máxima:</label><br>
            <input class="inputForms" name="Edad_max" style="width:15%;" min="0" type="number" placeholder="..."><br>


        </div>



        <label>Profesor:</label><br>
        <select class="inputForms" name="IdUsuario" style="height: 3.5vh;">
            <option>Pablo</option>
            <option>Sele</option>
            <option>Cesár</option>
            <option>Pablo</option>
        </select><br>
        <label>Costo:</label><br>
        <input class="inputForms" name="Costo" type="number" placeholder="Escribir..."><br>
        <div class="error">
            <p>El nombre del taller ya existe!</p>
            <p>El nombre del taller ya existe!</p>
            <p>El nombre del taller ya existe!</p>
            <p>El nombre del taller ya existe!</p>
            <p>El nombre del taller ya existe!</p>
        </div>
        <div style="display: flex; justify-content: center;">
            <button style="" type="submit" class="buttons">Guardar</button>
        </div>
    </form>
</div>

<!--MODAL PARA EDITAR-->

<div class="modal" id="modal-EditTaller">
    <form asp-action="EditarTaller" asp-controller="Home" id="formEditTaller" method="post">
        <button class="cerrar" type="button">X</button><br>
        <div id="acomodar">
            <i class="material-symbols-outlined">person</i>
            <h2>Editar Taller</h2>
        </div><br>
        <input type="hidden" id="EditId" name="Id" />

        <label>Nombre:</label><br>
        <input class="inputForms" name="Nombre" id="editNombre" type="text" placeholder="Escribir..."><br>
        <label>Dias:</label><br>
        <input name="Dias" class="inputForms" id="editDias" type="text" placeholder="Escribir..."><br>

        <label>Espacios:</label><br>
        <input name="Espacios" class="inputForms" id="editEspacios" type="number" min="0" placeholder="Escribir..."><br>

        <div class="col">
            <label>Horario inicio:</label><br>
            <input name="Horariomax" class="inputForms" id="editHoraInicio" type="time" style="width:25%;"><br>
            <label>Horario final:</label><br>
            <input name="Horariofin" class="inputForms" id="edit-HoraFinal" type="time" style="width:25%;"><br>


        </div>
        <div class="col">
            <label>Edad minima:</label><br>
            <input name="Edadmin" class="inputForms" id="editEdadMin" style="width:15%;" min="0" type="number" placeholder="..."><br>
            <label>Edad máxima:</label><br>
            <input name="Edadmax" class="inputForms" id="editEdadMax" style="width:15%;" min="0" type="number" placeholder="..."><br>


        </div>

        <label>Profesor:</label><br>
        <select name="Profesor" id="editProfesor"  class="inputForms" style="height: 3.5vh;">
            <option>Pablo</option>
            <option>Sele</option>
            <option>Cesár</option>
            <option>Pablo</option>
        </select><br>
        <label>Costo:</label><br>
        <input name="Costo" class="inputForms" id="editCosto" type="number" min="0" placeholder="Escribir..."><br>
        <div class="error">
            <p>El nombre del taller ya existe!</p>
            <p>El nombre del taller ya existe!</p>
            <p>El nombre del taller ya existe!</p>
            <p>El nombre del taller ya existe!</p>
            <p>El nombre del taller ya existe!</p>
        </div>
        <div style="display: flex; justify-content: center;">
            <button type="submit" style="display: flex; justify-content: center;" class="buttons">Guardar</button>
        </div>
    </form>
</div>

<!--MODAL PARA ELIMINAR-->
<div class="modal" id="modal-DeleteTaller">
    <form style=" margin: 33vh auto; ">
        <button class="cerrar" type="button">X</button><br>
        <fieldset>
            <legend>
                <h2>¿Desea eliminar este taller?</h2>
                <label style="color: red; font-size: 3vh;">AcuarelaKids</label>
            </legend>
        </fieldset>
        <div style="margin: 0vh 0 0 1vw; justify-content: flex-end; display: flex;">
            <button type="submit" class="buttons">Confirmar</button>
        </div>
    </form>
</div>





<header class="principal">
    <div class="izq">
        <i class="menu material-symbols-outlined">menu</i>
        <h2>Talleres</h2>
    </div>
    <img id="ig2" src="~/img/Historial.png" />
</header>


<div class="filtros">
    <div class="buscador">
        <form method="get" action="@Url.Action("MyAction", "MyController")">
        <input type="search"id="search" placeholder="Nombre, edad, día..." />
        </form>
        <div class="checar">
            <input type="checkbox" id="talleresActuales" />
            <label for="talleresActuales">Ver solo talleres actuales</label>
        </div>
    </div>


    <div class="BotonesTaller">
        <input id="aggTaller" type="button" value="Crear taller" />
        <input id="verAlumno" class="verLista" type="button" href="/Admin/Home/Alumnos" value="Lista de alumnos" />
    </div>

</div>


<div class="tablita">
    <div class="tabla-scroll">

        <table>
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Días</th>
                    <th>Espacios</th>
                    <th>Horario</th>
                    <th>Edad</th>
                    <th>Profesor</th>
                    <th>Costo</th>
                    <th>Opciones</th>
                </tr>

            </thead>

            <tbody>
                @foreach (var taller in Model)
                {
                    <tr>
                        <td>@taller.Nombre</td>
                        <td>@taller.Dias</td>
                        <td>@taller.Espacios</td>
                        <td>@taller.Horario</td>
                        <td>@taller.Edad</td>
                        <td>@taller.Profesor</td>
                        <td>$@taller.Costo</td>
                        <td>
                            <div class="botones">
                                <a href="#" data-id="@taller.Id">
                                    <img class="btneditar" src="~/img/edit.png" />
                                </a>
                                <a href="@Url.Action("Eliminar", "Home", new { id = taller, area = "Admin" })" class="btneliminar">
                                    <img class="btneliminar" src="~/img/X.png" />
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>

</div>

<script>
    $(document).on("click", ".btneditar", function (e) {
        e.preventDefault();
        let id = $(this).data("id");

        $.get("/Admin/Home/GetTaller/" + id, function (data) {
            $("#edit-Id").val(data.id);
            $("#edit-Nombre").val(data.nombre);
            $("#edit-Dias").val(data.dias);
            $("#edit-Espacios").val(data.espacios);
            $("#edit-HoraInicio").val(data.horaInicio);
            $("#edit-HoraFinal").val(data.horaFinal);
            $("#edit-EdadMin").val(data.edadMin);
            $("#edit-EdadMax").val(data.edadMax);

            // Formatear costo sin símbolo de moneda para edición
            $("#edit-Costo").val(data.costo.replace(/[^\d.-]/g, ''));

            $("#edit-Profesor").val(data.idUsuario);
            $("#modal-EditTaller").fadeIn();
        });
    });

    $("#formEditTaller").on("submit", function (e) {
        e.preventDefault();

        let costo = $("#edit-Costo").val().replace(/[^\d.-]/g, '');

        let taller = {
            Id: $("#edit-Id").val(),
            Nombre: $("#edit-Nombre").val(),
            Dias: $("#edit-Dias").val(),
            LugaresDisp: $("#edit-Espacios").val(),
            HoraInicio: $("#edit-HoraInicio").val(),
            HoraFinal: $("#edit-HoraFinal").val(),
            EdadMin: $("#edit-EdadMin").val(),
            EdadMax: $("#edit-EdadMax").val(),
            Costo: parseFloat(costo),
            IdUsuario: $("#edit-Profesor").val()
        };

        $.ajax({
            url: "/Admin/Home/EditarTaller",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(taller),
            success: function (resp) 
        });
    }
            </script>
